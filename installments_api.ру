from flask import Blueprint, request, jsonify
from app import db
from models import Installment, Client

installment_bp = Blueprint('installment_bp', _name_)

@installment_bp.route('/api/installments', methods=['POST'])
def add_installment():
    data = request.get_json()
    new_inst = Installment(
        client_id=data['client_id'],
        amount=data['amount'],
        months=data['months'],
        start_date=data['start_date']
    )
    db.session.add(new_inst)
    db.session.commit()
    return jsonify({'message': 'Рассрочка добавлена'}), 201

@installment_bp.route('/api/installments', methods=['GET'])
def get_installments():
    data = Installment.query.all()
    return jsonify([{
        'id': i.id,
        'client': i.client.name,
        'amount': i.amount,
        'months': i.months,
        'start_date': i.start_date
    } for i in data])
